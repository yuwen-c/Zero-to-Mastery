## platforms for app
- Heroku is a platform that can put your app on 
- traditional platform, like hostgator, uses apache server, suits for content website, just hang on those files.
- some famous choice for deploy app: 
  - amazon webservice
  - digital ocean
  - engine yard
  - Heroku

## plan
- front-end => git-pages (or Heroku)
- server => Heroku
- database => Heroku

## steps

### sign up Heroku

### installation Heroku CLI 
- use homebrew, have to turn off SIP, see 74.
- use documentation: https://devcenter.heroku.com/articles/heroku-cli#download-and-install

### Deploying with Git
- https://devcenter.heroku.com/articles/git#prerequisites-install-git-and-the-heroku-cli
- use git commands to deploy 

- login
```
$ heroku login

Logging in... done
Logged in as yuwen.azulejos@gmail.com
MarinedeiMac:smartcomputer marine$ heroku create
Creating app... done, ⬢ blooming-peak-04094
https://blooming-peak-04094.herokuapp.com/ | https://git.heroku.com/blooming-peak-04094.git
```

- create an App
```
$ heroku create

Creating app... done, ⬢ immense-river-02070
https://immense-river-02070.herokuapp.com/ | https://git.heroku.com/immense-river-02070.git
```

- see remote
```
$ git remote -v

heroku  https://git.heroku.com/immense-river-02070.git (fetch)
heroku  https://git.heroku.com/immense-river-02070.git (push)
origin  https://github.com/yuwenGithub/smartcomputerAPI.git (fetch)
origin  https://github.com/yuwenGithub/smartcomputerAPI.git (push)
```

- add remote repo
```
$ heroku git:remote -a thawing-inlet-61413 // change to your repo name
```

- run the app
```
heroku open
```

- see the records of server running, find where is the problem (every time you run this command, it will list all records since the very beginning the server starts)
```
heroku logs --tail
```

- set remote repo
```
heroku...-a...
```

### issue 1. sh: 1: nodemon: not found
- reason:
On Heroku, dev dependencies never get installed. However nodemon is a dev dependency...
- so change this script in package.json
```
nodemon server.js
```
To
```
 "scripts": {
    "start": "node server.js",
    "start:dev": "nodemon server.js"
    .....    
  },
```
### issue 2. Error R10 (Boot timeout) -> Web process failed to bind to $PORT within 60 seconds of launch
- PORT, we hardcode port 3000 but Heroku got it's own port, so use process.env.PORT
```
app.listen(process.env.PORT || 3000, () => {    // assign an environment variable or just use port 3000
  console.log(`it's running on PORT ${process.env.PORT})
}) 
```

### issue 3. (node:23) UnhandledPromiseRejectionWarning: Error: connect ECONNREFUSED 127.0.0.1:5432
- the get method of root route: / , we do query to database which we haven't connected to it, so:
```
// original:
app.get('/', (req, res) => {
    db.select('*').from('users').then(users => res.json(users))
})
```
to:
```
app.get('/', (req, res) => {
    res.send('send: connecting to server');
    console.log('console: connecting!!');
})

// sending string => shows on page
// console string => shows on terminal, when you use ```heroku logs --tail```
```
```
2020-07-30T03:50:53.000000+00:00 app[api]: Build succeeded
2020-07-30T03:50:53.267956+00:00 heroku[web.1]: Restarting
2020-07-30T03:50:53.270327+00:00 heroku[web.1]: State changed from up to starting
2020-07-30T03:50:54.129706+00:00 heroku[web.1]: Stopping all processes with SIGTERM
2020-07-30T03:50:54.238624+00:00 heroku[web.1]: Process exited with status 143
2020-07-30T03:50:55.703570+00:00 heroku[web.1]: Starting process with command `npm start`
2020-07-30T03:50:58.358230+00:00 app[web.1]: 
2020-07-30T03:50:58.358252+00:00 app[web.1]: > smartcomputer-api@1.0.0 start /app
2020-07-30T03:50:58.358252+00:00 app[web.1]: > node server.js
2020-07-30T03:50:58.358253+00:00 app[web.1]: 
2020-07-30T03:50:58.905790+00:00 app[web.1]: it's running on port 54717!
2020-07-30T03:50:59.327383+00:00 heroku[web.1]: State changed from starting to up
2020-07-30T03:51:52.531419+00:00 app[web.1]: console: connecting!!
2020-07-30T03:51:52.535084+00:00 heroku[router]: at=info method=GET path="/" host=immense-river-02070.herokuapp.com request_id=1cc77251-3063-4892-82e1-3fcf5c8084bd fwd="220.133.197.60" dyno=web.1 connect=0ms service=15ms status=200 bytes=258 protocol=https
```

### push
- after changing your code, do ```git add```, ```commit``` and push to Heroku master ```git push heroju master```      
***but git repo will not change***

### server url
- after register your app on Heroku, it gives you a url
- it represents when you connect to this url, you connect to your server, which runs on Heroku computer
(before, we run it on localhost/3000 on our computer)
- so, theoratically, now we can replace the url on front end app with that url, to see if it works.
- basically, we can see an error message from register catch, since we haven't connect the database.


## database part

### heroku setting on website
### postgre commands
postgrl:info?? see documentation

\d, \q in and out to postgresql
### change knex setting in our project

### testing if it works

## Npm Serve
- some version of react may have errors when deploying on Heroku, so install this

https://create-react-app.dev/docs/deployment/#static-server

## front end can also put on heroku. (or just let it on github page)
- do settings on heroku and follow documentation

